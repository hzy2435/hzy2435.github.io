<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>hibernate-validator 使用</title>
      <link href="/2020/04/05/hibernate-validator/"/>
      <url>/2020/04/05/hibernate-validator/</url>
      
        <content type="html"><![CDATA[<h2 id="hibernate-validator-是什么"><a href="#hibernate-validator-是什么" class="headerlink" title="hibernate-validator 是什么"></a>hibernate-validator 是什么</h2><p>hibernate-validator 提供了符合 JSR 303 规范中所有内置 constraint 的实现，为 JavaBean 验证定义了相应的元数据模型和 API。简单地理解，使用 hibernate-validator 可以在项目中优雅地实现参数校验，并重用校验规则。</p><h2 id="使用-hibernate-validator"><a href="#使用-hibernate-validator" class="headerlink" title="使用 hibernate-validator"></a>使用 hibernate-validator</h2><h3 id="环境要求："><a href="#环境要求：" class="headerlink" title="环境要求："></a>环境要求：</h3><ul><li>最新版本的 hibernate-validator 要求 JDK &gt;= 8</li></ul><h3 id="Maven-引入（非-Spring-Boot-项目）："><a href="#Maven-引入（非-Spring-Boot-项目）：" class="headerlink" title="Maven 引入（非 Spring Boot 项目）："></a>Maven 引入（非 Spring Boot 项目）：</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.hibernate<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hibernate-validator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>6.1.2.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="Spring-Boot-项目："><a href="#Spring-Boot-项目：" class="headerlink" title="Spring Boot 项目："></a>Spring Boot 项目：</h3><p>默认情况下，<code>spring-boot-starter-web</code> 中已包含 <code>hibernate-validator</code> 依赖，所以只需要引入 <code>spring-boot-starter-web</code>：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="hibernate-validator-常用注解"><a href="#hibernate-validator-常用注解" class="headerlink" title="hibernate-validator 常用注解"></a>hibernate-validator 常用注解</h2><p>hibernate-validator 包含以下常用注解：</p><table><thead><tr><th>序号</th><th>注解</th><th>说明</th></tr></thead><tbody><tr><td>1</td><td><code>@NotNull</code></td><td>判断非 null，常用于判断装饰类/自定义类不为 null</td></tr><tr><td>2</td><td><code>@NotEmpty</code></td><td>判断非 null，并且长度大于1；常用于判断集合不能为空</td></tr><tr><td>3</td><td><code>@NotBlank</code></td><td>判断非 null，并且去除前后空格后长度大于1；常用于判断字符串不能为空</td></tr><tr><td>4</td><td><code>@Null</code></td><td>判断 null</td></tr><tr><td>5</td><td><code>@Length</code></td><td>限制字符串的长度，@Length(min=1, max=50) 限制字符串长度在 1~50 间</td></tr><tr><td>6</td><td><code>@Size</code></td><td>限制集合的大小，@Size(min=1) 限制集合至少包含一个元素</td></tr><tr><td>7</td><td><code>@Past</code></td><td>检验日期是否为过去的日期</td></tr><tr><td>8</td><td><code>@Future</code></td><td>校验日期是否为将来的日期</td></tr><tr><td>9</td><td><code>@Min</code></td><td>校验值是否大于等于给定的值</td></tr><tr><td>10</td><td><code>@Max</code></td><td>校验值是否小于等于给定的值</td></tr><tr><td>11</td><td><code>@Digits</code></td><td>限制值的整数位和小数位，@Digits(intege=2,fraction=4) 限制2位整数和4位小数</td></tr><tr><td>12</td><td><code>@DecimalMin</code></td><td>限制 Decimal 类型数据大于等于给定值</td></tr><tr><td>13</td><td><code>@DecimalMax</code></td><td>限制 Decimal 类型数据小于等于给定值</td></tr><tr><td>14</td><td><code>@AssertTrue</code></td><td>限制 boolean 类型的值为 true</td></tr><tr><td>15</td><td><code>@AssertFalse</code></td><td>限制 boolean 类型的值为 false</td></tr><tr><td>16</td><td><code>@Pattern</code></td><td>自定义正则表达式校验</td></tr><tr><td>17</td><td><code>@Valid</code></td><td>递归的对关联的对象进行校验</td></tr><tr><td></td><td><code>@ScriptAssert</code></td><td>自定义校验脚本校验，可用于二选一情况的校验</td></tr></tbody></table><h2 id="在SpringBoot中校验示例"><a href="#在SpringBoot中校验示例" class="headerlink" title="在SpringBoot中校验示例"></a>在SpringBoot中校验示例</h2><ol><li><p>对 SysUser Bean 进行校验：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> len</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2020-02-19</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode</span>(callSuper = <span class="keyword">true</span>)</span><br><span class="line"><span class="meta">@ApiModel</span>(value=<span class="string">"SysUser对象"</span>, description=<span class="string">"用户账号密码表"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SysUser</span> <span class="keyword">extends</span> <span class="title">BaseEntity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(value = <span class="string">"用户账号"</span>, required = <span class="keyword">true</span>)</span><br><span class="line">    <span class="meta">@NotEmpty</span>(message = <span class="string">"账号不能为空"</span>)</span><br><span class="line">    <span class="meta">@Length</span>(max = <span class="number">20</span>, message = <span class="string">"账号长度最多 20"</span>)</span><br><span class="line">    <span class="keyword">private</span> String account;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(value = <span class="string">"账号密码"</span>, required = <span class="keyword">true</span>)</span><br><span class="line">    <span class="meta">@Pattern</span>(regexp = <span class="string">"^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z]&#123;8,16&#125;$"</span>, message = <span class="string">"密码必须含有数字和字母，且长度要在8-16位之间"</span>, groups = AddGroup<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">    <span class="title">private</span> <span class="title">String</span> <span class="title">password</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(value = <span class="string">"盐值"</span>)</span><br><span class="line">    <span class="keyword">private</span> String salt;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(value = <span class="string">"账号状态"</span>)</span><br><span class="line">    <span class="meta">@NotBlank</span>(message = <span class="string">"账号状态不能为空"</span>, groups = UpdateGroup<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">    <span class="title">private</span> <span class="title">String</span> <span class="title">state</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(value = <span class="string">"用户角色"</span>)</span><br><span class="line">    <span class="meta">@NotEmpty</span>(message = <span class="string">"需要为用户分配至少一种角色"</span>)</span><br><span class="line">    <span class="meta">@Valid</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;SysRole&gt; sysRoles;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><ul><li><p>注：这里使用了分组校验，所有的校验都属于某个分组，默认情况下，没注明表示属于 <code>Default</code> 分组。这在某些情况下很有用，比如新增和更新时校验规则并不完全一样，这里新增时不需要校验用户状态，但更新是需要状态不为空。</p></li><li><p><code>AddGroup</code>，<code>UpdateGroup</code> 是自定义的接口：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AddGroup</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UpdateGroup</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><ol start="2"><li><p>在控制器中启动校验：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> len</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2020-02-19</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@CrossOrigin</span> <span class="comment">// 允许跨域</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/user/sys-user"</span>)</span><br><span class="line"><span class="meta">@Api</span>(value = <span class="string">"/user/sys-user"</span>, tags = <span class="string">"用户控制器"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SysUserController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="meta">@ApiOperation</span>(value = <span class="string">"添加新用户"</span>, notes = <span class="string">"用户"</span>, httpMethod = <span class="string">"POST"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseEntity <span class="title">createUser</span><span class="params">(@Validated(&#123;AddGroup.class, Default.class&#125;)</span> @RequestBody SysUser sysUser) <span class="keyword">throws</span> BaseException </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> ResponseUtil.success(userInfoService.createUser(sysUserInfoDTO));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在控制器中指明，需要校验的对象，使用 <code>@Validated</code> 注解，并指定校验分组，这里指定应用 <code>AddGroup</code> 和 <code>Default</code> 两个分组的校验规则。</p></li><li><p>当校验不通过时会产生校验异常，可以在异常拦截接口处统一处理所有的校验异常，并包装成自定义的返回类型：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 异常控制器</span></span><br><span class="line"><span class="comment"> * Created by len on 2020-02-20 23:04</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@RestControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExceptionController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * hibernate validator 数据绑定验证异常拦截</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@ResponseStatus</span>(HttpStatus.OK)</span><br><span class="line">  <span class="meta">@ExceptionHandler</span>(BindException<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">  <span class="title">public</span> <span class="title">ResponseEntity</span> <span class="title">bindExceptionHandle</span>(<span class="title">BindException</span> <span class="title">e</span>) </span>&#123;</span><br><span class="line">    ObjectError error = e.getAllErrors().get(<span class="number">0</span>);</span><br><span class="line">    log.info(<span class="string">"数据验证异常：&#123;&#125;"</span>, error.getDefaultMessage());</span><br><span class="line">    <span class="keyword">return</span> ResponseUtil.error(error.getDefaultMessage(), ResponseEntity.ResponseCode.BAD_REQUEST);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * hibernate validator 数据绑定验证异常拦截</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@ResponseStatus</span>(HttpStatus.OK)</span><br><span class="line">  <span class="meta">@ExceptionHandler</span>(MethodArgumentNotValidException<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">  <span class="title">public</span> <span class="title">ResponseEntity</span> <span class="title">methodArgumentNotValidExceptionHandler</span>(<span class="title">MethodArgumentNotValidException</span> <span class="title">e</span>) </span>&#123;</span><br><span class="line">    ObjectError error = e.getBindingResult().getAllErrors().get(<span class="number">0</span>);</span><br><span class="line">    log.info(<span class="string">"数据验证异常：&#123;&#125;"</span>, error.getDefaultMessage());</span><br><span class="line">    <span class="keyword">return</span> ResponseUtil.error(error.getDefaultMessage(), ResponseEntity.ResponseCode.BAD_REQUEST);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * spring validator 方法参数验证异常拦截</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@ResponseStatus</span>(HttpStatus.OK)</span><br><span class="line">  <span class="meta">@ExceptionHandler</span>(ConstraintViolationException<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">  <span class="title">public</span> <span class="title">ResponseEntity</span> <span class="title">constraintViolationExceptionHandler</span>(<span class="title">ConstraintViolationException</span> <span class="title">e</span>) </span>&#123;</span><br><span class="line">    Set&lt;ConstraintViolation&lt;?&gt;&gt; violations = e.getConstraintViolations();</span><br><span class="line">    ConstraintViolation&lt;?&gt; violation = violations.iterator().next();</span><br><span class="line">    log.info(<span class="string">"数据验证异常：&#123;&#125;"</span>, violation.getMessage());</span><br><span class="line">    <span class="keyword">return</span> ResponseUtil.error(violation.getMessage(), ResponseEntity.ResponseCode.BAD_REQUEST);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 自定义异常</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@ResponseStatus</span>(HttpStatus.OK)</span><br><span class="line">  <span class="meta">@ExceptionHandler</span>(BaseException<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">  <span class="title">public</span> <span class="title">ResponseEntity</span> <span class="title">systemExceptionHandler</span>(<span class="title">BaseException</span> <span class="title">e</span>) </span>&#123;</span><br><span class="line">    log.error(<span class="string">"The request occur errors.&#123;&#125;"</span>, e);</span><br><span class="line">    <span class="keyword">return</span> ResponseUtil.error(e.getErrMsg(), e.getErrCode());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@ResponseStatus</span>(HttpStatus.OK)</span><br><span class="line">  <span class="meta">@ExceptionHandler</span>(Exception<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">  <span class="title">public</span> <span class="title">ResponseEntity</span> <span class="title">defaultExceptionHandler</span>(<span class="title">Exception</span> <span class="title">e</span>) </span>&#123;</span><br><span class="line">    log.error(<span class="string">"The request occur errors.&#123;&#125;"</span>, e);</span><br><span class="line">    <span class="keyword">return</span> ResponseUtil.error(e.getMessage());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>至此，完成了对用户的校验。</p></li></ol><h2 id="自定义校验注解"><a href="#自定义校验注解" class="headerlink" title="自定义校验注解"></a>自定义校验注解</h2><p>有时候，hibernate-validator 提供的校验规则并不能满足我们，比如对枚举的校验。这是，我们可以自定义自己的校验注解。以校验枚举类型为例：</p><h4 id="创建校验注解类："><a href="#创建校验注解类：" class="headerlink" title="创建校验注解类："></a>创建校验注解类：</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by len on 2020-02-29 10:17</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Target</span>(&#123;ElementType.FIELD, ElementType.METHOD, ElementType.CONSTRUCTOR, ElementType.ANNOTATION_TYPE, ElementType.PARAMETER, ElementType.TYPE_USE&#125;)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Repeatable</span>(Enum.List<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">@<span class="title">Constraint</span>(<span class="title">validatedBy</span> </span>= &#123; EnumValidator<span class="class">.<span class="keyword">class</span> &#125;)</span></span><br><span class="line"><span class="class"><span class="title">public</span> @<span class="title">interface</span> <span class="title">Enum</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function">String <span class="title">message</span><span class="params">()</span> <span class="keyword">default</span> "Enum is out of scope"</span>;</span><br><span class="line"></span><br><span class="line">  Class&lt;?&gt;[] groups() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  Class&lt;? extends Payload&gt;[] payload() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * the enum's class-type</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span> Class</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  Class&lt;?&gt; clazz();</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * the method's name, which used to validate the enum's value</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span> method's name</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function">String <span class="title">method</span><span class="params">()</span> <span class="keyword">default</span> "ordinal"</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Documented</span></span><br><span class="line">  <span class="meta">@Target</span>(&#123;ElementType.FIELD, ElementType.METHOD, ElementType.ANNOTATION_TYPE, ElementType.CONSTRUCTOR, ElementType.PARAMETER, ElementType.TYPE_USE&#125;)</span><br><span class="line">  <span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line">  <span class="meta">@interface</span> List &#123;</span><br><span class="line">    Enum[] value();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里通过 <code>@Target</code> 指明注解可以应用的类型，比如 <code>ElementType.FIELD</code> 表示注解可以应用在字段上。<code>@Constraint</code> 指明校验器，这里为 <code>EnumValidator</code> 类，具体实现参考下文。</p><p><code>Enum</code> 类中的 <code>Class&lt;?&gt; clazz();</code> 由使用者提供枚举的 class 对象，<code>String method() default &quot;ordinal&quot;;</code> 指明枚举进行校验的方法名，默认根据枚举 <code>oridinal</code> 进行校验。</p><h4 id="实现-ConstraintValidator-接口，实现具体的校验规则："><a href="#实现-ConstraintValidator-接口，实现具体的校验规则：" class="headerlink" title="实现 ConstraintValidator 接口，实现具体的校验规则："></a>实现 ConstraintValidator 接口，实现具体的校验规则：</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by len on 2020-02-29 10:29</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EnumValidator</span> <span class="keyword">implements</span> <span class="title">ConstraintValidator</span>&lt;<span class="title">Enum</span>, <span class="title">Object</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> Enum annotation;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initialize</span><span class="params">(Enum constraintAnnotation)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.annotation = constraintAnnotation;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isValid</span><span class="params">(Object value, ConstraintValidatorContext context)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (value == <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Object[] objects = annotation.clazz().getEnumConstants();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      Method method = annotation.clazz().getMethod(annotation.method());</span><br><span class="line">      <span class="keyword">for</span> (Object o : objects) &#123;</span><br><span class="line">        <span class="keyword">if</span> (value.equals(method.invoke(o))) &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>通过实现 <code>ConstraintValidator</code> 中的 <code>isValid</code> 方法，返回 true 表示校验通过，false 表示校验失败，并触发校验异常。</p><h4 id="使用-Enum-校验枚举"><a href="#使用-Enum-校验枚举" class="headerlink" title="使用 @Enum 校验枚举"></a>使用 @Enum 校验枚举</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiModelProperty</span>(value = <span class="string">"性别码"</span>, required = <span class="keyword">true</span>)</span><br><span class="line"><span class="meta">@NotNull</span>(message = <span class="string">"性别不能为空"</span>)</span><br><span class="line"><span class="meta">@Enum</span>(method = <span class="string">"getCode"</span>, clazz = SysUserEnum.Sex<span class="class">.<span class="keyword">class</span>, <span class="title">message</span> </span>= <span class="string">"性别状态码错误"</span>)</span><br><span class="line"><span class="meta">@ExcelIgnore</span></span><br><span class="line"><span class="keyword">private</span> Integer sexCode;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SysUserEnum</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Getter</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">enum</span> Sex &#123;</span><br><span class="line">    MALE(<span class="number">0</span>, <span class="string">"男"</span>), FEMALE(<span class="number">1</span>, <span class="string">"女"</span>), UNKNOWN(<span class="number">2</span>, <span class="string">"未知"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> code;</span><br><span class="line">    <span class="keyword">private</span> String desc;</span><br><span class="line"></span><br><span class="line">    Sex(<span class="keyword">int</span> code, String desc) &#123;</span><br><span class="line">      <span class="keyword">this</span>.code = code;</span><br><span class="line">      <span class="keyword">this</span>.desc = desc;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="特殊场景"><a href="#特殊场景" class="headerlink" title="特殊场景"></a>特殊场景</h2><p>在实际使用中，发现有一种业务场景需要对两个字段进行二选一校验，即只需要其中一个字段的值不为空的情况，这时候可以使用 <code>@ScriptAssert</code> 注解实现。比如，有一个场景，采购单有商品名和商品照片两个字段，这两个字段值不能同时为空，可以这样做：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ScriptAssert</span>(lang = <span class="string">"javascript"</span>, script = <span class="string">"(itemName != null &amp;&amp; itemName.trim() != '') OR (itemPicture != null &amp;&amp; itemPicture.trim() != '') "</span>, message = <span class="string">"商品名和商品照片不能同时为空"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TradeOrderItem</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String itemName;</span><br><span class="line">    <span class="keyword">private</span> String itemPicture;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> 校验 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
